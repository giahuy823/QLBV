@page
@model QLBV.Pages.ChuyenMon.ChiTietPhieuKhamModel
@{
    ViewData["Title"] = "Chi tiết phiếu khám bệnh";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>@ViewData["Title"]</h2>
        <div>
            <a asp-page="./DanhSachPhieuKham" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Quay lại
            </a>
        </div>
    </div>

    <!-- Thông tin chung -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center bg-primary text-white">
            <h6 class="m-0 font-weight-bold">Thông tin chung</h6>
            <span class="badge badge-light">
                @Model.PhieuKhamBenh.NgayKham
            </span>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group row">
                        <label class="col-sm-4 font-weight-bold">Mã phiếu khám:</label>
                        <div class="col-sm-8">@Model.PhieuKhamBenh.MaPk</div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 font-weight-bold">Bệnh nhân:</label>
                        <div class="col-sm-8">@Model.PhieuKhamBenh.NguoiKhamNavigation.HoTenBn</div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 font-weight-bold">Ngày sinh:</label>
                        <div class="col-sm-8">@Model.PhieuKhamBenh.NguoiKhamNavigation.NgaySinh?.ToString("dd/MM/yyyy")</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group row">
                        <label class="col-sm-4 font-weight-bold">SĐT:</label>
                        <div class="col-sm-8">@Model.PhieuKhamBenh.NguoiKhamNavigation.Sdt</div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 font-weight-bold">Bác sĩ:</label>
                        <div class="col-sm-8">@Model.PhieuKhamBenh.BacsiNavigation.MaBsNavigation.HoTenNv</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Thông tin khám bệnh -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 bg-info text-white">
            <h6 class="m-0 font-weight-bold">Thông tin khám bệnh</h6>
        </div>
        <div class="card-body">
            <p class="border p-3 rounded bg-light">@Model.PhieuKhamBenh.TrieuChung</p>
        </div>
    </div>

    <!-- Thủ tục -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 bg-warning text-dark">
            <h6 class="m-0 font-weight-bold">Danh sách thủ tục chỉ định</h6>
        </div>
        <div class="card-body">
            @if (Model.DanhSachThuTuc.Any())
            {
                <table class="table table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th>STT</th>
                            <th>Tên thủ tục</th>
                            <th>Đơn giá</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var (index, tt) in Model.DanhSachThuTuc.Select((value, i) => (i + 1, value)))
                        {
                            <tr>
                                <td>@index</td>
                                <td>@tt.MaTtNavigation.TenTuc</td>
                                <td class="text-right">@tt.SoTien VNĐ</td>
                                <td>
                                    <span class="badge @(tt.TtthanhToan == "Đã thanh toán" ? "badge-success" : "badge-warning")">
                                        @tt.TtthanhToan
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="alert alert-info">Không có thủ tục nào.</div>
            }
        </div>
    </div>

    <!-- Toa thuốc -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white">
            <h6 class="m-0 font-weight-bold">Toa thuốc</h6>
        </div>
        <div class="card-body">
            @if (Model.ToaThuoc != null)
            {
                <div class="mb-3">
                    <div class="row">
                        <div class="col-md-6">
                            <label><strong>Ngày kê đơn:</strong> @Model.ToaThuoc.NgayKe?.ToString("dd/MM/yyyy")</label>
                        </div>
                        <div class="col-md-6">
                            <label><strong>Bác sĩ kê đơn:</strong> @Model.PhieuKhamBenh.BacsiNavigation.MaBsNavigation.HoTenNv</label>
                        </div>
                    </div>
                </div>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Tên thuốc</th>
                            <th>Đơn vị</th>
                            <th>Số lượng</th>
                            <th>Liều dùng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var (index, thuoc) in Model.DanhSachThuoc.Select((v, i) => (i + 1, v)))
                        {
                            <tr>
                                <td>@index</td>
                                <td>@thuoc.MaThuocNavigation.TenThuoc</td>
                                <td>@thuoc.MaThuocNavigation.DonVi</td>
                                <td>@thuoc.SoLuong</td>
                                <td>@thuoc.LieuDung</td>
                            </tr>
                        }
                    </tbody>
                </table>
                <div class="text-right font-weight-bold">
                    Tổng tiền: @Model.ToaThuoc.TongTien VNĐ
                </div>
            }
            else
            {
                <div class="alert alert-info">Chưa có toa thuốc.</div>
            }
        </div>
    </div>
</div>
